// Generated by MyGeneration Version # (1.3.0.9)
using System;
using System.Collections.Generic;
using System.ServiceModel;
using System.Text;
using Legendigital.Framework.Common.BaseFramework.Bussiness.Wrappers;
using Legendigital.Framework.Common.Bussiness.Interfaces;
using Legendigital.Framework.Common.Data.Interfaces;
using Legendigital.Framework.Common.Bussiness.NHibernate;
using Legendigital.Framework.Common.BaseFramework.Data.Tables;
using Legendigital.Framework.Common.BaseFramework.Entity.Tables;
using Spring.Transaction.Interceptor;


namespace Legendigital.Framework.Common.BaseFramework.Bussiness.ServiceProxys.Tables
{
    [ServiceContract(Namespace = "http://Legendigital.Framework.Common.BaseFramework.Bussiness.ServiceProxys.Tables")]
    public interface ISystemDictionaryServiceProxy : IBaseSpringNHibernateEntityServiceProxy<SystemDictionaryEntity>, ISystemDictionaryServiceProxyDesigner
    {
        [OperationContract]
        IList<SystemDictionaryEntity> GetDictionaryByCategoryName(string categoryName);
        [OperationContract]
        string ParseDictionaryValueByCategoryNameAndKey(string categoryName, string key);
        [OperationContract]
        List<string> GetAllCategoryNames();

        List<SystemDictionaryEntity> FindAllByGroupIdAndOrder();
        void PatchAdd(string category, bool hasValue, string categoryItems);
    }

    public partial class SystemDictionaryServiceProxy : ISystemDictionaryServiceProxy
    {
        public IList<SystemDictionaryEntity> GetDictionaryByCategoryName(string categoryName)
        {
            return this.SelfDataObj.GetDictionaryByCategoryName(categoryName);
        }

        public string ParseDictionaryValueByCategoryNameAndKey(string categoryName, string key)
        {
            SystemDictionaryEntity dictionaryEntity = this.SelfDataObj.GetDictionaryByCategoryNameAndKey(categoryName,
                                                                                                         key);
            if(dictionaryEntity==null)
                return key;
            else
                return dictionaryEntity.SystemDictionaryValue;
        }

        public List<string> GetAllCategoryNames()
        {
            return this.SelfDataObj.GetAllCategoryNames();
        }

        public List<SystemDictionaryEntity> FindAllByGroupIdAndOrder()
        {
            return this.SelfDataObj.FindAllByGroupIdAndOrder();
        }

        [Transaction(ReadOnly = false)]
        public void PatchAdd(string category, bool hasValue, string categoryItems)
        {
            int orderIndex = 0;

            orderIndex = FindMaxOrderByCategory(category);

            List<string> items = new List<string>();

            if (!string.IsNullOrEmpty(categoryItems))
            {
                string[] arrays = categoryItems.Trim().Replace("\r\n", "\n").Replace("\n", "@").Split('@');

                foreach (string line in arrays)
                {
                    if (!string.IsNullOrEmpty(line.Trim()))
                    {
                        items.Add(line);
                    }
                }
            }

            foreach (string item in items)
            {
                orderIndex++;

                string key = "";

                string value = "";

                if(hasValue)
                {
                    key = item.Split('|')[0];
                    value = item.Split('|')[1];
                }
                else
                {
                    key = item;
                    value = item;                    
                }

                SystemDictionaryEntity obj = new SystemDictionaryEntity();

                obj.SystemDictionaryCategoryID = category;
                obj.SystemDictionaryKey = key;
                obj.SystemDictionaryValue = value;
                obj.SystemDictionaryDesciption = "";
                obj.SystemDictionaryOrder = orderIndex;
                obj.SystemDictionaryIsEnable = true;
                obj.SystemDictionaryIsSystem = false;

                this.DataObjectsContainerIocID.SystemDictionaryDataObjectInstance.Save(obj);

            }
        }

        public int FindMaxOrderByCategory(string category)
        {
            SystemDictionaryEntity systemDictionary = this.SelfDataObj.FindMaxOrderItemByCategory(category);

            if (systemDictionary == null)
                return 0;

            if (systemDictionary.SystemDictionaryOrder == null)
                return 0;

            return systemDictionary.SystemDictionaryOrder.Value;
        }
    }
}
