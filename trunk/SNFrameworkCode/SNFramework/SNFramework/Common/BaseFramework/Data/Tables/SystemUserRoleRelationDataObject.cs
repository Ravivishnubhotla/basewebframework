// Generated by MyGeneration Version # (1.3.0.9)
using System;
using System.Collections.Generic;
using System.Text;
using NHibernate.Criterion;
using Legendigital.Framework.Common.Data.NHibernate.DynamicQuery;
using Legendigital.Framework.Common.BaseFramework.Entity.Tables;
using Legendigital.Framework.Common.Data.NHibernate;

namespace Legendigital.Framework.Common.BaseFramework.Data.Tables
{
    public partial class SystemUserRoleRelationDataObject
    {
        /// <summary>
        /// 获取用户分配的角色
        /// </summary>
        /// <param name="user">用户</param>
        /// <returns></returns>
        public List<SystemRoleEntity> GetUserAssignedRoles(SystemUserEntity user)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(PROPERTY_USERID.Eq(user));

            return this.FindListByProjection<SystemRoleEntity>(queryGenerator, SystemUserRoleRelationDataObject.PROPERTY_ROLEID.CriterionProperty);
        }

        /// <summary>
        /// 获取角色包含的所有用户
        /// </summary>
        /// <param name="role">角色</param>
        /// <returns></returns>
        public List<SystemUserEntity> GetRoleAssignedUsers(SystemRoleEntity role)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(SystemUserRoleRelationDataObject.PROPERTY_ROLEID.Eq(role));

            return
                this.FindListByProjection<SystemUserEntity>(queryGenerator, SystemUserRoleRelationDataObject.PROPERTY_USERID.CriterionProperty);
        }

        /// <summary>
        /// 获取用户角色关系是否存在
        /// </summary>
        /// <param name="user">用户</param>
        /// <param name="role">角色</param>
        /// <returns></returns>
        public SystemUserRoleRelationEntity GetUserRoleRelation(SystemUserEntity user, SystemRoleEntity role)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(PROPERTY_USERID.Eq(user));

            queryGenerator.AddWhereClause(PROPERTY_ROLEID.Eq(role));

            return this.FindSingleEntityByQueryBuilder(queryGenerator);
        }

        public List<SystemUserRoleRelationEntity> GetUserRoleRelationByUser(SystemUserEntity user)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(PROPERTY_USERID.Eq(user));

            return this.FindListByQueryBuilder(queryGenerator);
        }

        public SystemRoleEntity GetUserMaxRoleTypeRole(SystemUserEntity systemUserEntity)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(PROPERTY_USERID.Eq(systemUserEntity));

            InClude_RoleID_Query(queryGenerator);

            queryGenerator.AddOrderBy(PROPERTY_ROLEID_ROLETYPE.Desc());

            SystemUserRoleRelationEntity userRoleRelationEntity = this.FindSingleEntityByQueryBuilder(queryGenerator);

            if(userRoleRelationEntity==null)
                return null;
            else
                return userRoleRelationEntity.RoleID;
        }

        public SystemRoleEntity GetUserMinRoleTypeRole(SystemUserEntity systemUserEntity)
        {
            NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

            queryGenerator.AddWhereClause(PROPERTY_USERID.Eq(systemUserEntity));

            InClude_RoleID_Query(queryGenerator);

            queryGenerator.AddOrderBy(PROPERTY_ROLEID_ROLETYPE.Asc());

            SystemUserRoleRelationEntity userRoleRelationEntity = this.FindSingleEntityByQueryBuilder(queryGenerator);

            if (userRoleRelationEntity == null)
                return null;
            else
                return userRoleRelationEntity.RoleID;
        }


        //public List<SystemUserRoleRelationEntity> GetUserByRole(List< string> roleTypes)
        //{
        //    NHibernateDynamicQueryGenerator<SystemUserRoleRelationEntity> queryGenerator = this.GetNewQueryBuilder();

        //    queryGenerator.AddWhereClause( PROPERTY_ROLEID_ROLETYPE.In(roleTypes));

        //    return this.FindListByQueryBuilder(queryGenerator);
        //}

        public static DetachedCriteria SubQueryGetUserAssignedRoles(SystemUserEntity user)
        {
            DetachedCriteria criteria = DetachedCriteria.For(typeof(SystemUserRoleRelationEntity));

            criteria.Add(SystemUserRoleRelationDataObject.PROPERTY_USERID.Eq(user));

            criteria.SetProjection(SystemUserRoleRelationDataObject.PROPERTY_ROLEID.CriterionProperty);

            return criteria;
        }
    }
}
